var EMJP3={};EMJP3.Model=function(){this.word_index=0,this.word={ind:0,word_split:[],fg_split:[],type:"",def:""}},EMJP3.View=function(a){var b=a,c=this;this.edit_word={edit_mode:!1,step2:function(){var a=b.word,d=$("#word-input").val(),e=d.split("");if(c.edit_word.edit_mode)var f=a.word_split==e,g=a.fg_split.split(",");a.word_split=e;for(var h=0;h<a.word_split.length;h++){var i=document.createElement("div");i.setAttribute("id","char-input-"+h),i.setAttribute("class","char-input");var j=document.createDocumentFragment(),k=document.createElement("input");k.setAttribute("type","text"),k.setAttribute("id","fg-input-"+h),k.setAttribute("name","fg-input-"+h),k.setAttribute("class","fg-input"),f&&k.setAttribute("value",g[h]);var l=document.createElement("input");l.setAttribute("type","text"),l.setAttribute("id","kj-input-"+h),l.setAttribute("name","kj-input-"+h),l.setAttribute("class","kj-input"),l.setAttribute("value",a.word_split[h]),j.appendChild(k),j.appendChild(l),i.appendChild(j),$("#reading-input").append(i)}},step3:function(){var a=b.word;a.fg_split=[];for(var d=0;d<a.word_split.length;d++){var e=$("#fg-input-"+d).val();a.fg_split.push(e);var f=document.createElement("div");f.setAttribute("id","char-preview-"+d),f.setAttribute("class","char-preview");var g=document.createDocumentFragment(),h=document.createElement("div");h.setAttribute("id","fg-preview-"+d),h.setAttribute("class","fg-preview"),h.innerHTML=e;var i=document.createElement("div");i.setAttribute("id","kj-preview-"+d),i.setAttribute("class","kj-preview"),i.innerHTML=a.word_split[d],g.appendChild(h),g.appendChild(i),f.appendChild(g),$("#word-display").append(f)}if(!c.edit_word.edit_mode){var j=b.word_index+1;$("#word-index").val(j)}$("#word-split").val(a.word_split),$("#fg-split").val(a.fg_split)}},this.popups={show:function(a){$(a).css("display","block")},hide:function(a){$(a).css("display","none")}}},EMJP3.Controller=function(a,b){var c=a,d=b,e=this;this.init_view=function(){e.word_list.bind_list_btns(),$("#edit-next-1").on("click",d.edit_word.step2),$("#edit-next-2").on("click",d.edit_word.step3),$("#edit-submit").on("click",e.edit_word.submit_new),$("a#reset-form").on("click",function(a){e.edit_word.reset_form()}),$("a#clear-words").on("click",function(a){d.popups.show("#confirm-clear-words")}),$("#confirm-clear-words #yes").on("click",function(a){e.clear_words()}),$("#confirm-clear-words #no").on("click",function(a){d.popups.hide("#confirm-clear-words")}),$("#confirm-delete-word #no").on("click",function(a){d.popups.hide("#confirm-delete-word")})},this.word_list={bind_list_btns:function(){for(var a=$(".edit-word-btn"),b=0;b<a.length;b++){var c=$(a[b]).attr("data-word-index"),f="input#edit-word-"+c;$(f).on("click",function(a){var b=this.getAttribute("data-word-index"),c={ind:b};e.edit_word.reset_form(),e.edit_word.set_form(c),$("#edit-submit").unbind(),$("#edit-submit").on("click",e.edit_word.submit_edit)});var g="input#del-word-"+c;$(g).on("click",function(a){var b=this.getAttribute("data-word-index");e.delete_word.to_delete=b,$("#confirm-delete-word #yes").unbind(),$("#confirm-delete-word #yes").on("click",function(a){var b=e.delete_word.to_delete,c={ind:b};e.delete_word.execute(c)}),d.popups.show("#confirm-delete-word")})}}},this.edit_word={submit_new:function(){var a=$("form#word-edit").serialize();$.ajax({method:"POST",url:"includes/submit-new.php",data:a,success:function(a){$("#vocab-list").text(""),$("#vocab-list").append(a),e.word_list.bind_list_btns(),e.edit_word.reset_form(),c.word_index+=1}})},submit_edit:function(){var a=$("form#word-edit").serialize();$.ajax({method:"POST",url:"includes/submit-edit.php",data:a,success:function(a){$("#vocab-list").text(""),$("#vocab-list").append(a),e.word_list.bind_list_btns(),e.edit_word.reset_form()}})},reset_form:function(){$("#word-edit").find("input[type=text], input[type=hidden], textarea").val(""),$("#word-display, #reading-input").text(""),$("#word-edit #title").text("New Word"),$("#edit-submit").unbind(),$("#edit-submit").on("click",e.edit_word.submit_new),d.edit_word.edit_mode=!1},set_form:function(a){$.ajax({method:"POST",url:"includes/fetch-word.php",data:a,success:function(a){var b=JSON.parse(a);$("#word-index").val(b.ind),$("#word-split").val(b.word),$("#word-input").val(b.word.split(",").join("")),$("#fg-split").val(b.reading),$("#word-type").val(b.type),$("#word-def").val(b.def),$("#word-edit #title").text("Edit Word"),c.word.ind=b.ind,c.word.word_split=b.word,c.word.fg_split=b.reading,d.edit_word.edit_mode=!0}})}},this.delete_word={to_delete:0,execute:function(a){$.ajax({method:"POST",url:"includes/delete-word.php",data:a,success:function(a){$("#vocab-list").text(""),$("#vocab-list").append(a),e.word_list.bind_list_btns(),d.popups.hide("#confirm-delete-word")}})}},this.clear_words=function(){$.ajax({method:"POST",url:"includes/clear-words.php",success:function(){window.location.reload()}})}};